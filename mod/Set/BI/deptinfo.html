<!--
Author  : zhangjia
Date    : 20131030
Describe: deptinfo
-->
<div class="row-fluid">
    <div class="pull-left" style="padding:10px 14px">

        <h4>
            
            <% if (serverdata.departmentId) {%>
                部门编辑 - <%=serverdata.departmentName%>
            <%} else {%>
                新增部门
            <%}%>
        </h4>

    </div>
<% if(serverdata.departmentName){%>
    <div class="pull-right" style="padding:10px 14px">
        <a class="btn icn-only green" id="depOthBtn" href="#" data-dept="<%=serverdata.departmentId%>"><i class="m-icon-swapleft m-icon-white"></i> 更多设置</a>                          
    </div>
<%}%>
</div>

<form action="" class="form-horizontal" method="post" id="deptInfoForm">

	<h5 class="form-section">基本信息</h5>

	<div class="row-fluid">

        <div class="span6">

			<div class="control-group">

				<label class="control-label">部门名称<span class="required">*</span></label>

				<div class="controls">

					<input type="text" name="departmentName" class="span10 m-wrap" value="<%=serverdata.departmentName%>">

				</div>

			</div>

        </div>

		
		<input type="hidden" name="departmentId" value="<%=serverdata.departmentId%>" />

        <div class="span6">

			<div class="control-group">

				<label class="control-label">父级部门<span class="required">*</span></label>

				<div class="controls">

					<select class="span10 m-wrap" data-placeholder="请选择部门" name="superDepartmentId" id="deptOptList">
						<option value="">-请选择-</option>

					</select>

				</div>

			</div>

        </div>

    </div>

	
	<div class="row-fluid">

        <div class="span6">

        	<div class="control-group">

				<label class="control-label">部门颜色标识<span class="required">*</span></label>

				<div class="controls">

					<div class="input-append color colorpicker-default" data-color="<%if(serverdata.departmentColor){%>
						<%=serverdata.departmentColor%>
						<%}else{%>#000000<%}%>" data-color-format="rgba">

						<input type="text" class="span5 m-wrap" name="departmentColor" value="<%=serverdata.departmentColor%>" />

						<span class="add-on"><i style="background-color:<%if(serverdata.departmentColor){%>
						<%=serverdata.departmentColor%>
						<%}else{%>#000000<%}%>"></i></span>

					</div>

				</div>

			</div>

        </div>


        <div class="span6">

        	<div class="control-group">

				<label class="control-label">部门排序号<span class="required">*</span></label>

				<div class="controls">

					<input type="text" name="departmentSortNumber" class="span6 m-wrap" value="<%=serverdata.departmentSortNumber%>">

				</div>

			</div>

        </div>

    </div>

	
	<div class="row-fluid">

        <div class="span12">

			<div class="control-group">

				<label class="control-label">部门简述</label>

				<div class="controls">

					<textarea class="span6 m-wrap" name="departmentDescribe" rows="5">
						<%=serverdata.departmentDescribe%></textarea>

				</div>

			</div>

        </div>

    </div>

	<h5 class="form-section">职位信息</h5>
	
    <div class="row-fluid">

        <div class="span6">
        	<div class="control-group">
		
				<label class="control-label">部门副主管</label>
		
				<div class="controls">
		
					<select class="span10 m-wrap chosen" data-placeholder="请选择部门副主管" name="dept_fu[]" multiple="multiple">

						<option value="">请选择</option>

						<option value="Category 1" selected="selected">赖镇东</option>						

						<option value="Category 1" selected="selected">陈万才</option>

						<option value="Category 2">张佳</option>

						<option value="Category 3">熊瑛琪</option>

					</select>
		
				</div>
		
			</div>
        </div>

        <div class="span6">
				<div class="control-group">
		
				<label class="control-label">部门主管</label>
		
				<div class="controls">
		
					<select class="span10 m-wrap chosen" data-placeholder="请选择部门主管" name="dept_zhu[]" multiple="multiple">

						<option value="">请选择</option>

						<option value="Category 1" selected="selected">赖镇东</option>						

						<option value="Category 1">陈万才</option>

						<option value="Category 2">张佳</option>

						<option value="Category 3">熊瑛琪</option>

					</select>
		
				</div>
		
			</div>
            </div>
        </div>
		
		<div class="row-fluid">
		
            <div class="span6">
            	<div class="control-group">
		
				<label class="control-label">部门直管</label>
		
					<div class="controls">
			
						<select class="span10 m-wrap chosen" name="dept_direct[]" multiple="multiple">
							
						 	<option value="">请选择</option>
							
							<option value="1" selected="selected">王乐</option>						
							
							<option value="2">张轩樵</option>
							
							<option value="3">余杰</option>
							
							<option value="4" selected="selected">贺洁华</option>

						</select>
			
					</div>
		
				</div>
        	</div>

        	<div class="span6">

            	<div class="control-group">
		
					<label class="control-label">部门分管</label>
		
					<div class="controls">
			
						<select class="span10 m-wrap chosen" data-placeholder="部门分管" name="dept_seperat[]" multiple="multiple">

							<option value="">请选择</option>

							<option value="8">王乐</option>						

							<option value="9" selected="selected">张轩樵</option>

							<option value="5">余杰</option>

							<option value="6">贺洁华</option>

							<option value="3" selected="selected">董事长</option>																

						</select>
			
					</div>
		
				</div>

        	</div>

    </div> 
 

    <div class="form-actions">
         
         <% if (serverdata.departmentId) {%>
        <button class="btn blue" id="deptSaveBtn">保存</button>
        <%} else {%>
         <button class="btn blue" id="deptAddBtn">提交</button>
         <%}%>
                     
        <input class="btn" type="reset" value="重置" />                            
                     
    </div>

</form>

<script type="text/javascript">
$(function(){

	var urlfix = "<%=urlfix%>";

	var urljasonfix = eval(urlfix);

	//部门其它信息修改
	$("#depOthBtn").on('click',function(){

		var deptId = $(this).attr('data-dept');

        $("#deptInfo").removeClass('active');
        $("#deOthInfo").addClass('active');

        //加载部门职称
        urljasonfix.depJob =
	    [{
	        "ra":"depJob",
	        "dir":"Set/BI/deptjob",
	        "dif":'department/listDepartmentJobTitles',
	        "p":{"deptId":deptId}
	    }];

	    yixunload(urljasonfix.depJob,urlfix);

	    return false;
	    //加载虚拟部门
	    urljasonfix.depVirt =
	    [{
	        "ra":"depVirt",
	        "dir":"Set/BI/deptvirt",
	        "dif":'',
	        "p":{"deptId":deptId}
	    }];
	    yixunload(urljasonfix.depVirt,urlfix);

    })

	//加载父级部门列表
    urljasonfix.deptOptList =
    [{
        "ra":"deptOptList",
        "dir":"Com/deptlist",
        "dif":'department/listAllDepartments',
        "p":{"deptId":''},
        "m":2
    }];
    yixunload(urljasonfix.deptOptList,urlfix);

     //return false;
	$('.colorpicker-default').colorpicker({
        format: 'hex'
    });

    $(".chosen").each(function () {
            $(this).chosen({
            	no_results_text: "没有匹配结果",
                allow_single_deselect: $(this).attr("data-with-diselect") === "1" ? true : false
            });
        });
    //表单验证
	$("#deptInfoForm").validate({
        errorElement: 'span', //default input error message container
        errorClass: 'help-inline', // default input error message class
        rules: {
            departmentName: {
                minlength: 2,
                required: true,
            },
            departmentColor: {
                required: true,
            },
            departmentSortNumber: {
                required: true,
            }

        },

        messages: { 
            departmentName: {
                required: "部门名称不能为空",
                minlength: "部门名称至少为两个字符",
            },
            departmentColor: {
                required: "部门必须设置一个颜色标识",
            },
            departmentSortNumber: {
                required: "部门排序号为必填项",
            }
        },

        highlight: function (element) { // hightlight error inputs
            $(element)
                .closest('.help-inline').removeClass('ok'); // display OK icon
            $(element)
                .closest('.control-group').removeClass('success').addClass('error'); // set error class to the control group
        },

        unhighlight: function (element) { // revert the change dony by hightlight
            $(element)
                .closest('.control-group').removeClass('error'); // set error class to the control group
        },

        success: function (label) {
            if (label.attr("for") == "service" || label.attr("for") == "membership") { // for checkboxes and radip buttons, no need to show OK icon
                label
                    .closest('.control-group').removeClass('error').addClass('success');
                label.remove(); // remove error label here
            } else { // display success icon for other inputs
                label
                    .addClass('valid').addClass('help-inline ok') // mark the current input as valid and display OK icon
                .closest('.control-group').removeClass('error').addClass('success'); // set success class to the control group
            }
        }
               
    });

    //新增部门信息
    $("#deptAddBtn").click(function(){
         
        if($("#deptInfoForm").valid()){

            $('#deptInfoForm').submit(function() {              

                var data = $(this).serialize(); //序列化表单数据
                console.log(data);

                return false;
                $.getJSON(
                    "http://10.188.192.200:8080/YIXUN_1.5_EE/department/addDepartment?jsoncallback=?", data,
                    function(json) {
                        console.log(json);
                    }
                ); 
                return false; 
            }); 
        }
    }); 

    //保存部门信息
    $("#deptSaveBtn").click(function(){

        if($("#deptInfoForm").valid()){

            $('#deptInfoForm').submit(function() {

                var data = $(this).serialize(); //序列化表单数据 
                console.log(data);
                return false;
                $.getJSON(
                    "http://10.188.192.200:8080/YIXUN_1.5_EE/department/updateDepartment?jsoncallback=?", data,
                    function(json) {
                        console.log(json);
                    }
                ); 
                return false; 
                
            }); 
        }
    });
})
</script>